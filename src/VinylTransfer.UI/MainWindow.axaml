<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:controls="clr-namespace:VinylTransfer.UI.Controls"
        mc:Ignorable="d"
        x:Class="VinylTransfer.UI.MainWindow"
        Title="Vinyl Transfer DeClick"
        Width="1200"
        Height="720">
  <Grid ColumnDefinitions="320,*" RowDefinitions="Auto,*,Auto" Margin="16">
    <TextBlock Grid.ColumnSpan="2" FontSize="22" FontWeight="SemiBold"
               Text="Vinyl Transfer Cleanup" />

    <ScrollViewer Grid.Row="1" Grid.Column="0" Margin="0,16,16,0"
                  HorizontalScrollBarVisibility="Disabled"
                  VerticalScrollBarVisibility="Auto">
      <StackPanel Spacing="16">
        <Border BorderBrush="#2D2D2D" BorderThickness="1" CornerRadius="6" Padding="12">
          <StackPanel Spacing="8">
            <TextBlock FontWeight="SemiBold" Text="1. Import" />
            <TextBlock FontSize="12" Foreground="Gray" TextWrapping="Wrap"
                       Text="Load a WAV so it can be analyzed and cleaned." />
            <Button Content="Import WAV"
                    Command="{Binding ImportWavCommand}"
                    ToolTip.Tip="Load a WAV file from disk so it can be analyzed and cleaned." />
          </StackPanel>
        </Border>

        <Border BorderBrush="#2D2D2D" BorderThickness="1" CornerRadius="6" Padding="12">
          <StackPanel Spacing="8">
            <TextBlock FontWeight="SemiBold" Text="2. Analyze &amp; Tune" />
            <TextBlock FontSize="12" Foreground="Gray" TextWrapping="Wrap"
                       Text="Get suggested settings or tweak the sliders below." />
            <TextBlock FontSize="12" Foreground="Gray" TextWrapping="Wrap"
                       Text="Choose a preset to jump-start common vinyl profiles." />
            <ComboBox ItemsSource="{Binding PresetOptions}"
                      SelectedItem="{Binding SelectedPreset}"
                      DisplayMemberBinding="{Binding Name}"
                      ToolTip.Tip="Select a preset tuned for common vinyl profiles." />
            <Button Content="Recommend Settings"
                    Command="{Binding RecommendSettingsCommand}"
                    ToolTip.Tip="Scan the audio and suggest slider values." />
            <TextBlock FontSize="12" Foreground="Gray" TextWrapping="Wrap"
                       Text="Analyze the recording and suggest cleanup settings." />
            <Button Content="Auto Clean"
                    Command="{Binding AutoCleanCommand}"
                    ToolTip.Tip="Run the cleanup pass using the current settings." />
            <TextBlock FontSize="12" Foreground="Gray" TextWrapping="Wrap"
                       Text="Apply cleanup with the current settings." />
          </StackPanel>
        </Border>

        <Border BorderBrush="#2D2D2D" BorderThickness="1" CornerRadius="6" Padding="12">
          <StackPanel Spacing="8">
            <TextBlock FontWeight="SemiBold" Text="3. Preview" />
            <TextBlock FontSize="12" Foreground="Gray" TextWrapping="Wrap"
                       Text="Compare original vs. cleaned audio." />
            <Button Content="A/B Preview"
                    Command="{Binding PreviewCommand}"
                    ToolTip.Tip="Toggle the waveform between the original and cleaned versions." />
            <TextBlock FontSize="12" Foreground="Gray" TextWrapping="Wrap"
                       Text="Switch between original and cleaned audio previews." />
            <WrapPanel Orientation="Horizontal">
              <Button Content="Play Preview" Margin="0,0,8,8"
                      Command="{Binding PlayPreviewCommand}"
                      ToolTip.Tip="Play the currently selected preview audio." />
              <Button Content="Play From Cursor" Margin="0,0,8,8"
                      Command="{Binding PlayFromPositionCommand}"
                      ToolTip.Tip="Play from the scrub position on the timeline." />
              <Button Content="Play Event" Margin="0,0,8,8"
                      Command="{Binding PlayEventCommand}"
                      ToolTip.Tip="Play a short preview around the selected event." />
              <Button Content="Stop Playback" Margin="0,0,8,8"
                      Command="{Binding StopPreviewCommand}"
                      ToolTip.Tip="Stop audio playback." />
            </WrapPanel>
            <TextBlock FontSize="12" Foreground="Gray" TextWrapping="Wrap"
                       Text="Listen to the selected preview." />
            <TextBlock Text="Scrub Position" Margin="0,6,0,0" />
            <Grid ColumnDefinitions="*,Auto" VerticalAlignment="Center">
              <Slider Minimum="0" Maximum="1" Value="{Binding ScrubPosition}"
                      ToolTip.Tip="Scrub through the timeline and play from the cursor." />
              <TextBlock Grid.Column="1" Margin="8,0,0,0"
                         Text="{Binding ScrubTimecode}" />
            </Grid>
            <TextBlock Text="Event Preview" Margin="0,6,0,0" />
            <ComboBox ItemsSource="{Binding DetectedEventOptions}"
                      SelectedIndex="{Binding SelectedEventIndex}"
                      ToolTip.Tip="Select a detected event to preview." />
            <Grid ColumnDefinitions="*,Auto" VerticalAlignment="Center">
              <Slider Minimum="50" Maximum="1000" Value="{Binding EventPreviewMs}"
                      ToolTip.Tip="Preview duration in milliseconds." />
              <TextBlock Grid.Column="1" Margin="8,0,0,0"
                         Text="{Binding EventPreviewMs, StringFormat={}{0:0} ms}" />
            </Grid>
            <CheckBox Content="Loop event preview"
                      IsChecked="{Binding LoopPreview}"
                      ToolTip.Tip="Loop the event preview audio." />
            <Grid ColumnDefinitions="*,Auto" VerticalAlignment="Center">
              <Slider Minimum="1" Maximum="8" Value="{Binding LoopRepeats}"
                      ToolTip.Tip="Number of repeats when looping." />
              <TextBlock Grid.Column="1" Margin="8,0,0,0"
                         Text="{Binding LoopRepeats, StringFormat={}{0}x}" />
            </Grid>
          </StackPanel>
        </Border>

        <Border BorderBrush="#2D2D2D" BorderThickness="1" CornerRadius="6" Padding="12">
          <StackPanel Spacing="8">
            <TextBlock FontWeight="SemiBold" Text="4. Export" />
            <TextBlock FontSize="12" Foreground="Gray" TextWrapping="Wrap"
                       Text="Save the cleaned audio, or export the removed noise." />
            <Button Content="Export Processed WAV"
                    Command="{Binding ExportProcessedCommand}"
                    ToolTip.Tip="Save the cleaned audio to a new WAV file." />
            <Button Content="Export Difference WAV"
                    Command="{Binding ExportDifferenceCommand}"
                    ToolTip.Tip="Save only what was removed (useful for auditing cleanup)." />
            <Button Content="Export Event Markers"
                    Command="{Binding ExportEventsCommand}"
                    ToolTip.Tip="Export detected events as CSV or JSON for external review." />
          </StackPanel>
        </Border>

        <TextBlock FontWeight="SemiBold" Text="Manual Controls" Margin="0,8,0,0" />

        <TextBlock Text="Click Threshold" />
        <TextBlock FontSize="12" Foreground="Gray" TextWrapping="Wrap"
                   Text="Higher values focus on only the loudest clicks." />
        <Grid ColumnDefinitions="*,Auto" VerticalAlignment="Center">
          <Slider Minimum="0" Maximum="1" Value="{Binding ClickThreshold}"
                  ToolTip.Tip="Sensitivity for detecting short, sharp clicks." />
          <TextBlock Grid.Column="1" Margin="8,0,0,0"
                     Text="{Binding ClickThreshold, StringFormat={}{0:0.00}}" />
        </Grid>

        <TextBlock Text="Click Intensity" />
        <TextBlock FontSize="12" Foreground="Gray" TextWrapping="Wrap"
                   Text="How strongly detected clicks are smoothed out." />
        <Grid ColumnDefinitions="*,Auto" VerticalAlignment="Center">
          <Slider Minimum="0" Maximum="1" Value="{Binding ClickIntensity}"
                  ToolTip.Tip="Strength of click repair (0 = light, 1 = strong)." />
          <TextBlock Grid.Column="1" Margin="8,0,0,0"
                     Text="{Binding ClickIntensity, StringFormat={}{0:0.00}}" />
        </Grid>

        <TextBlock Text="Pop Threshold" />
        <TextBlock FontSize="12" Foreground="Gray" TextWrapping="Wrap"
                   Text="Higher values focus on only the most obvious pops." />
        <Grid ColumnDefinitions="*,Auto" VerticalAlignment="Center">
          <Slider Minimum="0" Maximum="1" Value="{Binding PopThreshold}"
                  ToolTip.Tip="Sensitivity for detecting longer pops." />
          <TextBlock Grid.Column="1" Margin="8,0,0,0"
                     Text="{Binding PopThreshold, StringFormat={}{0:0.00}}" />
        </Grid>

        <TextBlock Text="Pop Intensity" />
        <TextBlock FontSize="12" Foreground="Gray" TextWrapping="Wrap"
                   Text="How strongly detected pops are smoothed out." />
        <Grid ColumnDefinitions="*,Auto" VerticalAlignment="Center">
          <Slider Minimum="0" Maximum="1" Value="{Binding PopIntensity}"
                  ToolTip.Tip="Strength of pop repair (0 = light, 1 = strong)." />
          <TextBlock Grid.Column="1" Margin="8,0,0,0"
                     Text="{Binding PopIntensity, StringFormat={}{0:0.00}}" />
        </Grid>

        <TextBlock Text="Noise Floor" />
        <TextBlock FontSize="12" Foreground="Gray" TextWrapping="Wrap"
                   Text="Estimate the quietest background level to reduce hiss." />
        <Grid ColumnDefinitions="*,Auto" VerticalAlignment="Center">
          <Slider Minimum="-90" Maximum="-20" Value="{Binding NoiseFloorDb}"
                  ToolTip.Tip="Background noise level in dB (lower = quieter)." />
          <TextBlock Grid.Column="1" Margin="8,0,0,0"
                     Text="{Binding NoiseFloorDb, StringFormat={}{0:0} dB}" />
        </Grid>

        <TextBlock Text="Noise Reduction" />
        <TextBlock FontSize="12" Foreground="Gray" TextWrapping="Wrap"
                   Text="How much quiet background noise to reduce." />
        <Grid ColumnDefinitions="*,Auto" VerticalAlignment="Center">
          <Slider Minimum="0" Maximum="1" Value="{Binding NoiseReductionAmount}"
                  ToolTip.Tip="0 = none, 1 = maximum reduction." />
          <TextBlock Grid.Column="1" Margin="8,0,0,0"
                     Text="{Binding NoiseReductionAmount, StringFormat={}{0:0.00}}" />
        </Grid>
        <TextBlock Text="Spectral Masking" />
        <TextBlock FontSize="12" Foreground="Gray" TextWrapping="Wrap"
                   Text="Preserve musical detail by masking noise reduction under strong tones." />
        <Grid ColumnDefinitions="*,Auto" VerticalAlignment="Center">
          <Slider Minimum="0" Maximum="1" Value="{Binding SpectralMaskingStrength}"
                  ToolTip.Tip="Higher values retain more masked content." />
          <TextBlock Grid.Column="1" Margin="8,0,0,0"
                     Text="{Binding SpectralMaskingStrength, StringFormat={}{0:0.00}}" />
        </Grid>

        <TextBlock Text="Median Repair" />
        <TextBlock FontSize="12" Foreground="Gray" TextWrapping="Wrap"
                   Text="Uses a median filter to smooth sudden clicks and pops." />
        <CheckBox Content="Enable median-based repair"
                  IsChecked="{Binding UseMedianRepair}"
                  ToolTip.Tip="Median repair is good at removing sharp spikes without dulling transients." />

        <TextBlock Text="Spectral Noise Reduction" />
        <TextBlock FontSize="12" Foreground="Gray" TextWrapping="Wrap"
                   Text="Reduce hiss by subtracting a noise profile in the frequency domain." />
        <CheckBox Content="Enable spectral noise reduction"
                  IsChecked="{Binding UseSpectralNoiseReduction}"
                  ToolTip.Tip="Spectral noise reduction is more effective for steady hiss." />

        <TextBlock Text="Multi-Band Transient Detection" />
        <TextBlock FontSize="12" Foreground="Gray" TextWrapping="Wrap"
                   Text="Use frequency bands to detect small ticks and clicks." />
        <CheckBox Content="Enable multi-band transient detection"
                  IsChecked="{Binding UseMultiBandTransientDetection}"
                  ToolTip.Tip="Helps catch subtle ticks that are missed by a single threshold." />

        <TextBlock Text="Decrackle Pass" />
        <TextBlock FontSize="12" Foreground="Gray" TextWrapping="Wrap"
                   Text="Smooth dense micro-impulses before click/pop repair." />
        <CheckBox Content="Enable decrackle pass"
                  IsChecked="{Binding UseDecrackle}"
                  ToolTip.Tip="Targets dense micro-impulses to reduce crackle." />
        <Grid ColumnDefinitions="*,Auto" VerticalAlignment="Center">
          <Slider Minimum="0" Maximum="1" Value="{Binding DecrackleIntensity}"
                  ToolTip.Tip="Strength of the decrackle smoothing." />
          <TextBlock Grid.Column="1" Margin="8,0,0,0"
                     Text="{Binding DecrackleIntensity, StringFormat={}{0:0.00}}" />
        </Grid>

        <TextBlock Text="Band-Limited Repair" />
        <TextBlock FontSize="12" Foreground="Gray" TextWrapping="Wrap"
                   Text="Interpolate repaired samples using a band-limited kernel." />
        <CheckBox Content="Enable band-limited interpolation"
                  IsChecked="{Binding UseBandLimitedInterpolation}"
                  ToolTip.Tip="Uses band-limited interpolation to rebuild transients more naturally." />

        <TextBlock Text="Waveform Overlays" Margin="0,8,0,0" />
        <TextBlock FontSize="12" Foreground="Gray" TextWrapping="Wrap"
                   Text="Show detected events and noise profile overlays." />
        <CheckBox Content="Show click/pop markers"
                  IsChecked="{Binding ShowEventOverlay}"
                  ToolTip.Tip="Display detected click/pop locations on the waveform." />
        <CheckBox Content="Show clicks"
                  IsChecked="{Binding ShowClickMarkers}"
                  ToolTip.Tip="Toggle click markers." />
        <CheckBox Content="Show pops"
                  IsChecked="{Binding ShowPopMarkers}"
                  ToolTip.Tip="Toggle pop markers." />
        <CheckBox Content="Show decrackle"
                  IsChecked="{Binding ShowDecrackleMarkers}"
                  ToolTip.Tip="Toggle decrackle markers." />
        <Grid ColumnDefinitions="*,Auto" VerticalAlignment="Center">
          <Slider Minimum="0.1" Maximum="1" Value="{Binding EventOverlayOpacity}"
                  ToolTip.Tip="Opacity of event overlays." />
          <TextBlock Grid.Column="1" Margin="8,0,0,0"
                     Text="{Binding EventOverlayOpacity, StringFormat={}{0:0.00}}" />
        </Grid>
        <CheckBox Content="Show noise profile"
                  IsChecked="{Binding ShowNoiseProfileOverlay}"
                  ToolTip.Tip="Overlay the estimated noise profile across the waveform." />
        <Grid ColumnDefinitions="*,Auto" VerticalAlignment="Center">
          <Slider Minimum="0.1" Maximum="1" Value="{Binding NoiseProfileOpacity}"
                  ToolTip.Tip="Opacity of the noise profile overlay." />
          <TextBlock Grid.Column="1" Margin="8,0,0,0"
                     Text="{Binding NoiseProfileOpacity, StringFormat={}{0:0.00}}" />
        </Grid>

        <TextBlock Text="Timeline Zoom" Margin="0,8,0,0" />
        <TextBlock FontSize="12" Foreground="Gray" TextWrapping="Wrap"
                   Text="Zoom and pan the waveform/spectrogram for detailed inspection." />
        <Grid ColumnDefinitions="*,Auto" VerticalAlignment="Center">
          <Slider Minimum="1" Maximum="8" Value="{Binding ZoomFactor}"
                  ToolTip.Tip="Zoom level (1x = full timeline)." />
          <TextBlock Grid.Column="1" Margin="8,0,0,0"
                     Text="{Binding ZoomFactor, StringFormat={}{0:0.0}x}" />
        </Grid>
        <Grid ColumnDefinitions="*,Auto" VerticalAlignment="Center">
          <Slider Minimum="0" Maximum="1" Value="{Binding ViewOffset}"
                  ToolTip.Tip="Pan through the timeline when zoomed in." />
          <TextBlock Grid.Column="1" Margin="8,0,0,0"
                     Text="{Binding ViewOffset, StringFormat={}{0:0.00}}" />
        </Grid>
      </StackPanel>
    </ScrollViewer>

    <Grid Grid.Row="1" Grid.Column="1" RowDefinitions="Auto,*,Auto,*" ColumnDefinitions="*" Margin="0,16,0,0">
      <Grid ColumnDefinitions="*,Auto" VerticalAlignment="Center">
        <StackPanel Orientation="Horizontal" Spacing="8" VerticalAlignment="Center">
          <TextBlock Text="Waveform" FontWeight="SemiBold" />
          <TextBlock Text="{Binding PreviewSourceLabel}" Foreground="Gray" VerticalAlignment="Center" />
        </StackPanel>
        <Button Grid.Column="1"
                Content="Stop"
                Command="{Binding StopPreviewCommand}"
                IsEnabled="{Binding IsPlaying}"
                ToolTip.Tip="Stop audio playback." />
      </Grid>
      <Border Grid.Row="1" BorderBrush="Gray" BorderThickness="1" CornerRadius="6" Padding="8">
        <controls:WaveformView Buffer="{Binding DisplayBuffer}"
                               DetectedEvents="{Binding DetectedEvents}"
                               NoiseProfile="{Binding NoiseProfile}"
                               ShowEventOverlay="{Binding ShowEventOverlay}"
                               ShowNoiseProfileOverlay="{Binding ShowNoiseProfileOverlay}"
                               ShowClickMarkers="{Binding ShowClickMarkers}"
                               ShowPopMarkers="{Binding ShowPopMarkers}"
                               ShowDecrackleMarkers="{Binding ShowDecrackleMarkers}"
                               EventOverlayOpacity="{Binding EventOverlayOpacity}"
                               NoiseProfileOpacity="{Binding NoiseProfileOpacity}"
                               SelectedEventIndex="{Binding SelectedEventIndex}"
                               ZoomFactor="{Binding ZoomFactor}"
                               ViewOffset="{Binding ViewOffset}" />
      </Border>

      <TextBlock Grid.Row="2" Text="Spectrogram" FontWeight="SemiBold" Margin="0,16,0,0" />
      <Border Grid.Row="3" BorderBrush="Gray" BorderThickness="1" CornerRadius="6" Padding="8" Margin="0,8,0,0">
        <controls:SpectrogramView Buffer="{Binding DisplayBuffer}"
                                  ZoomFactor="{Binding ZoomFactor}"
                                  ViewOffset="{Binding ViewOffset}" />
      </Border>
    </Grid>

    <Border Grid.Row="2" Grid.ColumnSpan="2" BorderBrush="Gray" BorderThickness="1" CornerRadius="6" Padding="12" Margin="0,16,0,0">
      <TextBlock Text="{Binding StatusMessage}" />
    </Border>
  </Grid>
</Window>
